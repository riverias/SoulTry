<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SoulTry Chat</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap');
        
        :root {
            --neon-cyan: #00f0ff;
            --neon-purple: #b400ff;
            --neon-pink: #ff00e6;
            --text-glow: #e0b0ff;
            --space-dark: #0a0a1a;
            --space-light: #1e1e3a;
            --sidebar-width: 280px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }
        
        input, textarea {
            user-select: text;
            -webkit-user-select: text;
        }
        
        body {
            background: var(--space-dark);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            color: var(--text-glow);
            touch-action: pan-y;
            position: fixed;
        }
        
        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω */
        .gradient-bg {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(180, 0, 255, 0.2) 0%, transparent 25%),
                radial-gradient(circle at 70% 70%, rgba(0, 240, 255, 0.2) 0%, transparent 25%),
                radial-gradient(circle at 50% 20%, rgba(255, 0, 230, 0.15) 0%, transparent 25%);
            animation: bg-move 20s infinite alternate ease-in-out;
            z-index: -2;
        }
        
        @keyframes bg-move {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-5%, -5%); }
            50% { transform: translate(-10%, 5%); }
            75% { transform: translate(5%, 10%); }
        }
        
        /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        
        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            position: fixed;
            top: 0;
            left: calc(-1 * var(--sidebar-width));
            width: var(--sidebar-width);
            height: 100%;
            background: rgba(20, 20, 45, 0.95);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 10;
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar.active {
            transform: translateX(var(--sidebar-width));
        }
        
        /* –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .search-container {
            margin-bottom: 20px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(180, 0, 255, 0.3);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 12px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .search-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            border-radius: 15px;
            background: rgba(30, 30, 58, 0.8);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            visibility: hidden;
        }
        
        .search-results.active {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }
        
        .user-result {
            padding: 15px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .user-result:last-child {
            border-bottom: none;
        }
        
        .user-result:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
            border: 2px solid var(--neon-purple);
            box-shadow: 0 0 10px rgba(180, 0, 255, 0.5);
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-nickname {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 3px;
        }
        
        .user-username {
            font-size: 0.8rem;
            color: var(--neon-cyan);
        }
        
        .user-status {
            display: flex;
            align-items: center;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 3px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
            background: #00ff88;
        }
        
        .status-dot.offline {
            background: #ff4d4d;
        }
        
        .add-contact {
            background: transparent;
            color: var(--neon-purple);
            border: 1px solid var(--neon-purple);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-contact:hover {
            background: var(--neon-purple);
            color: white;
        }
        
        .add-contact.added {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            border-color: transparent;
            cursor: default;
        }
        
        /* –ö–æ–Ω—Ç–∞–∫—Ç—ã */
        .contacts-title {
            font-size: 1rem;
            margin: 20px 0 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .contacts-count {
            background: var(--neon-purple);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .contacts-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .contact-item {
            padding: 12px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .contact-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(3px);
        }
        
        .contact-item.active {
            background: rgba(180, 0, 255, 0.3);
            box-shadow: 0 0 15px rgba(180, 0, 255, 0.3);
        }
        
        .contact-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
            border: 2px solid var(--neon-purple);
            box-shadow: 0 0 10px rgba(180, 0, 255, 0.5);
        }
        
        .contact-info {
            flex: 1;
            overflow: hidden;
        }
        
        .contact-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .contact-last-msg {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .contact-time {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            margin-left: 10px;
        }
        
        /* –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        .profile {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
            position: relative;
            padding: 20px;
            background: rgba(30, 30, 58, 0.5);
            border-radius: 15px;
        }
        
        .avatar-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            margin-bottom: 15px;
            border: 3px solid var(--neon-purple);
            box-shadow: 0 0 20px rgba(180, 0, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        .avatar-container:hover {
            transform: scale(1.05);
        }
        
        .avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        
        .profile-info {
            text-align: center;
            width: 100%;
        }
        
        .nickname {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .username {
            font-size: 1rem;
            color: var(--neon-cyan);
            margin-bottom: 10px;
        }
        
        .profile-status {
            display: inline-block;
            padding: 3px 10px;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ */
        .chat-container {
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 35, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        .chat-container.sidebar-open {
            transform: translateX(var(--sidebar-width));
        }
        
        /* –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π */
        .chat-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            background: rgba(30, 30, 58, 0.7);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }
        
        .logo-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: transparent;
            border: none;
            position: absolute;
            left: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .logo-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .logo-btn img {
            width: 70%;
            height: 70%;
            object-fit: cover;
            transition: transform 0.3s ease;
            border-radius: 50%;
        }
        
        .logo-btn:hover img {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 0 5px var(--neon-pink));
        }
        
        .chat-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: white;
            text-shadow: 0 0 10px var(--neon-purple);
            width: 100%;
            text-align: center;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            z-index: 1;
            padding: 0 40px;
        }
        
        /* –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º */
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-purple) transparent;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--neon-purple), var(--neon-pink));
            border-radius: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π */
        .message {
            max-width: 85%;
            padding: 15px 18px;
            border-radius: 20px;
            line-height: 1.4;
            position: relative;
            animation: messageIn 0.4s ease-out forwards;
            word-break: break-word;
            opacity: 0;
            transform: translateY(10px);
            color: var(--text-glow);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes messageIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .received {
            background: rgba(255, 255, 255, 0.08);
            border-bottom-left-radius: 5px;
            align-self: flex-start;
            border-left: 3px solid var(--neon-cyan);
        }
        
        .sent {
            background: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%);
            color: white;
            border-bottom-right-radius: 5px;
            align-self: flex-end;
            border-right: 3px solid var(--neon-pink);
        }
        
        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
            font-family: 'Orbitron', sans-serif;
        }
        
        .video-message {
            max-width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .video-message video {
            width: 100%;
            border-radius: 8px;
        }
        
        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-container {
            padding: 15px 20px;
            background: rgba(20, 20, 45, 0.8);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .input-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .message-input {
            flex: 1;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
            color: var(--text-glow);
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        .message-input:focus {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 2px rgba(180, 0, 255, 0.3);
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%);
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(180, 0, 255, 0.3);
        }
        
        .send-btn:hover {
            transform: scale(1.05);
        }
        
        .send-btn:active {
            transform: scale(0.95);
        }
        
        .send-icon {
            width: 22px;
            height: 22px;
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.7));
        }
        
        .attach-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .attach-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(15deg);
        }
        
        .video-input {
            display: none;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: rgba(30, 30, 58, 0.95);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 30px rgba(180, 0, 255, 0.5);
            text-align: center;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: white;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px var(--neon-purple);
        }
        
        .modal-input {
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .modal-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px var(--neon-purple);
        }
        
        .modal-btn {
            background: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            width: 100%;
            box-shadow: 0 3px 15px rgba(180, 0, 255, 0.4);
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(180, 0, 255, 0.6);
        }
        
        .modal-btn:active {
            transform: translateY(0);
        }
        
        .username-error {
            color: #ff4d4d;
            font-size: 0.8rem;
            margin-top: -10px;
            margin-bottom: 10px;
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 25px;
            height: 25px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--neon-pink);
            animation: spin 1s ease-in-out infinite;
            margin: 10px auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); }
            to { transform: translateY(0); }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                width: 85%;
                left: -85%;
            }
            
            .chat-container.sidebar-open {
                transform: translateX(85%);
            }
            
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="gradient-bg"></div>
    
    <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ -->
    <div class="overlay" id="overlay"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-title">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</div>
            <input type="text" class="modal-input" id="register-nickname" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º">
            <input type="text" class="modal-input" id="register-username" placeholder="@–≤–∞—à_—é–∑–µ—Ä–Ω–µ–π–º">
            <div class="username-error" id="username-error">–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç</div>
            <button class="modal-btn" id="register-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sidebar" id="sidebar">
        <div class="search-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" class="search-input" id="search-input" placeholder="–ù–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π...">
            <div class="search-results" id="search-results"></div>
        </div>
        
        <div class="contacts-title">
            –ú–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã
            <span class="contacts-count" id="contacts-count">0</span>
        </div>
        <div class="contacts-list" id="contacts-list">
            <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
        
        <div class="profile">
            <div class="avatar-container">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2ZmMDBlNiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" alt="Avatar" class="avatar" id="avatar">
            </div>
            
            <div class="profile-info">
                <div class="nickname" id="nickname">–ì–æ—Å—Ç—å</div>
                <div class="username" id="username">@username</div>
                <div class="profile-status">online</div>
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
    <div class="chat-container" id="chat-container">
        <div class="chat-header">
            <button class="logo-btn" id="menu-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <div class="chat-title">SoulTry Chat</div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="message received">
                <div class="message-content">
                    –ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SoulTry Chat! üëã
                    <div class="message-time">12:34</div>
                </div>
            </div>
            
            <div class="message sent">
                <div class="message-content">
                    –ù–∞—á–Ω–∏ –æ–±—â–µ–Ω–∏–µ, –Ω–∞–π–¥—è –¥—Ä—É–∑–µ–π —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫!
                    <div class="message-time">12:35</div>
                </div>
            </div>
        </div>
        
        <div class="input-container">
            <div class="input-box">
                <button class="attach-btn" id="attach-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                    </svg>
                </button>
                <input type="text" class="message-input" id="message-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button class="send-btn" id="send-btn">
                    <svg class="send-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
                <input type="file" id="video-input" class="video-input" accept="video/*">
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏–º–∏—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞)
        const serverUsers = {
            'user1': {
                id: 'user1',
                avatar: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2I0MDBmZiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                nickname: '–ê–ª–µ–∫—Å–µ–π',
                username: '@alex',
                online: true
            },
            'user2': {
                id: 'user2',
                avatar: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzAwZjBmZiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                nickname: '–ú–∞—Ä–∏—è',
                username: '@mary',
                online: false
            },
            'user3': {
                id: 'user3',
                avatar: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzAwZmY4OCIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                nickname: '–î–º–∏—Ç—Ä–∏–π',
                username: '@dima',
                online: true
            },
            'user4': {
                id: 'user4',
                avatar: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2ZmOTkwMCIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                nickname: '–ê–Ω–Ω–∞',
                username: '@anna',
                online: true
            },
            'user5': {
                id: 'user5',
                avatar: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2ZmMDAwMCIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                nickname: '–ò–≤–∞–Ω',
                username: '@ivan',
                online: false
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const chatMessages = document.getElementById('chat-messages');
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const menuBtn = document.getElementById('menu-btn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const chatContainer = document.getElementById('chat-container');
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            const contactsList = document.getElementById('contacts-list');
            const attachBtn = document.getElementById('attach-btn');
            const videoInput = document.getElementById('video-input');
            const registerModal = document.getElementById('register-modal');
            const registerNickname = document.getElementById('register-nickname');
            const registerUsername = document.getElementById('register-username');
            const registerBtn = document.getElementById('register-btn');
            const usernameError = document.getElementById('username-error');
            const nicknameElement = document.getElementById('nickname');
            const usernameElement = document.getElementById('username');
            const avatarElement = document.getElementById('avatar');
            const contactsCount = document.getElementById('contacts-count');
            
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            let isMenuOpen = false;
            let currentChat = null;
            let contacts = {};
            let allUsers = {...serverUsers};
            let currentUser = null;
            let searchTimeout = null;
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
            function loadData() {
                const savedData = localStorage.getItem('soultryChatData');
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        contacts = data.contacts || {};
                        allUsers = {...serverUsers, ...(data.allUsers || {})};
                        currentChat = data.currentChat || null;
                        currentUser = data.currentUser || null;
                        
                        if (currentUser) {
                            updateProfile(currentUser);
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫, –µ—Å–ª–∏ –µ–≥–æ —Ç–∞–º –Ω–µ—Ç
                            if (!allUsers[currentUser.id]) {
                                allUsers[currentUser.id] = {...currentUser, online: true};
                            } else {
                                allUsers[currentUser.id].online = true;
                            }
                        }
                        
                        renderContacts();
                        updateContactsCount();
                        
                        if (currentChat) {
                            renderChat(currentChat);
                        }
                        
                        // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                        if (!currentUser) {
                            showRegisterModal();
                        } else {
                            hideRegisterModal();
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                        showRegisterModal();
                    }
                } else {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                    showRegisterModal();
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            function saveData() {
                const data = {
                    contacts,
                    allUsers: Object.keys(allUsers).reduce((acc, key) => {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ serverUsers
                        if (!serverUsers[key]) {
                            acc[key] = allUsers[key];
                        }
                        return acc;
                    }, {}),
                    currentChat,
                    currentUser
                };
                localStorage.setItem('soultryChatData', JSON.stringify(data));
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
            function updateProfile(user) {
                nicknameElement.textContent = user.nickname;
                usernameElement.textContent = user.username;
                avatarElement.src = user.avatar;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            function updateContactsCount() {
                contactsCount.textContent = Object.keys(contacts).length;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            function showRegisterModal() {
                registerModal.classList.add('active');
                overlay.classList.add('active');
            }
            
            // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            function hideRegisterModal() {
                registerModal.classList.remove('active');
                overlay.classList.remove('active');
            }
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
            function generateRandomAvatar() {
                const colors = ['#b400ff', '#00f0ff', '#ff00e6', '#00ff88', '#ff9900', '#ff0000'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                return `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0i${encodeURIComponent(color)}Ii8+PGNpcmNsZSBjeD0iNTAiIGN5PSIzNSIgcj0iMjAiIGZpbGw9IiNmZmYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjcwIiByPSIyNSIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==`;
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            registerBtn.addEventListener('click', function() {
                const nickname = registerNickname.value.trim();
                let username = registerUsername.value.trim().toLowerCase();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —é–∑–µ—Ä–Ω–µ–π–º —Å @
                if (!username.startsWith('@')) {
                    username = '@' + username;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —é–∑–µ—Ä–Ω–µ–π–º–∞
                if (!/^@[a-z0-9_]{3,20}$/.test(username)) {
                    usernameError.textContent = '–Æ–∑–µ—Ä–Ω–µ–π–º –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _ (3-20 —Å–∏–º–≤–æ–ª–æ–≤)';
                    usernameError.style.display = 'block';
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —é–∑–µ—Ä–Ω–µ–π–º–∞
                let usernameExists = false;
                for (const userId in allUsers) {
                    if (allUsers[userId].username.toLowerCase() === username.toLowerCase()) {
                        usernameExists = true;
                        break;
                    }
                }
                
                if (usernameExists) {
                    usernameError.textContent = '–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç';
                    usernameError.style.display = 'block';
                    return;
                } else {
                    usernameError.style.display = 'none';
                }
                
                if (nickname && username) {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userId = 'user' + Date.now();
                    currentUser = {
                        id: userId,
                        nickname,
                        username,
                        avatar: generateRandomAvatar(),
                        online: true
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    allUsers[userId] = {...currentUser};
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    saveData();
                    updateProfile(currentUser);
                    hideRegisterModal();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    addMessage(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${nickname}! –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –Ω–∞–π—Ç–∏ –¥—Ä—É–∑–µ–π –∏ –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ.`, true);
                }
            });
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é
            menuBtn.addEventListener('click', function() {
                isMenuOpen = !isMenuOpen;
                
                if (isMenuOpen) {
                    sidebar.classList.add('active');
                    overlay.classList.add('active');
                    chatContainer.classList.add('sidebar-open');
                } else {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    chatContainer.classList.remove('sidebar-open');
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
            overlay.addEventListener('click', function() {
                isMenuOpen = false;
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                chatContainer.classList.remove('sidebar-open');
            });
            
            // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É)
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                
                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ –ø—É—Å—Ç–∞—è
                if (searchTerm.length === 0) {
                    searchResults.classList.remove('active');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                searchResults.innerHTML = '<div class="loading"></div>';
                searchResults.classList.add('active');
                
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
                searchTimeout = setTimeout(() => {
                    searchResults.innerHTML = '';
                    
                    let foundUsers = 0;
                    
                    for (const userId in allUsers) {
                        const user = allUsers[userId];
                        
                        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–µ–±—è –∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã
                        if (currentUser && userId === currentUser.id) continue;
                        if (contacts[userId]) continue;
                        
                        // –ü–æ–∏—Å–∫ –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É –∏ –Ω–∏–∫–Ω–µ–π–º—É
                        if (user.username.toLowerCase().includes(searchTerm) || 
                            user.nickname.toLowerCase().includes(searchTerm)) {
                            
                            const userElement = document.createElement('div');
                            userElement.className = 'user-result';
                            userElement.innerHTML = `
                                <img src="${user.avatar}" class="user-avatar">
                                <div class="user-info">
                                    <div class="user-nickname">${user.nickname}</div>
                                    <div class="user-username">${user.username}</div>
                                    <div class="user-status">
                                        <div class="status-dot ${user.online ? '' : 'offline'}"></div>
                                        ${user.online ? 'online' : 'offline'}
                                    </div>
                                </div>
                                <button class="add-contact" data-userid="${userId}">
                                    ${contacts[userId] ? '–î–æ–±–∞–≤–ª–µ–Ω' : '–î–æ–±–∞–≤–∏—Ç—å'}
                                </button>
                            `;
                            searchResults.appendChild(userElement);
                            foundUsers++;
                        }
                    }
                    
                    if (foundUsers === 0) {
                        const noResults = document.createElement('div');
                        noResults.className = 'user-result';
                        noResults.style.textAlign = 'center';
                        noResults.style.padding = '20px';
                        noResults.textContent = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                        searchResults.appendChild(noResults);
                    }
                }, 800);
            });
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
            searchResults.addEventListener('click', function(e) {
                if (e.target.classList.contains('add-contact')) {
                    const userId = e.target.getAttribute('data-userid');
                    if (!contacts[userId]) {
                        contacts[userId] = { 
                            messages: [
                                { 
                                    text: `–í—ã –Ω–∞—á–∞–ª–∏ –æ–±—â–µ–Ω–∏–µ —Å ${allUsers[userId].nickname}!`, 
                                    time: getCurrentTime(), 
                                    isReceived: true 
                                }
                            ] 
                        };
                        saveData();
                        renderContacts();
                        updateContactsCount();
                        searchInput.value = '';
                        searchResults.classList.remove('active');
                        
                        // –ï—Å–ª–∏ —á–∞—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ —Å –Ω–æ–≤—ã–º –∫–æ–Ω—Ç–∞–∫—Ç–æ–º
                        if (!currentChat) {
                            currentChat = userId;
                            renderChat(userId);
                        }
                    }
                }
            });
            
            // –í—ã–±–æ—Ä —á–∞—Ç–∞
            contactsList.addEventListener('click', function(e) {
                const contactItem = e.target.closest('.contact-item');
                if (contactItem) {
                    const userId = contactItem.getAttribute('data-userid');
                    currentChat = userId;
                    saveData();
                    renderChat(userId);
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                    if (window.innerWidth < 768) {
                        isMenuOpen = false;
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                        chatContainer.classList.remove('sidebar-open');
                    }
                }
            });
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            sendBtn.addEventListener('click', function() {
                sendMessage();
            });
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ
            attachBtn.addEventListener('click', function() {
                videoInput.click();
            });
            
            videoInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && currentChat) {
                    if (file.size > 10 * 1024 * 1024) {
                        alert('–í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 10MB');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const videoUrl = event.target.result;
                        addVideoMessage(videoUrl, false);
                        contacts[currentChat].messages.push({
                            video: videoUrl,
                            time: getCurrentTime(),
                            isReceived: false
                        });
                        saveData();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
            function sendMessage() {
                const text = messageInput.value.trim();
                if (text && currentChat) {
                    addMessage(text, false);
                    contacts[currentChat].messages.push({
                        text,
                        time: getCurrentTime(),
                        isReceived: false
                    });
                    messageInput.value = '';
                    saveData();
                    
                    // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
                    if (Math.random() > 0.3) { // 70% chance of reply
                        setTimeout(() => {
                            const responses = [
                                "–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!",
                                "–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!",
                                "–î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ",
                                "–Ø –ø–æ–ª—É—á–∏–ª —Ç–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
                                "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —Ä–∞—Å—Å–∫–∞–∂–∏ –±–æ–ª—å—à–µ",
                                "–°–æ–≥–ª–∞—Å–µ–Ω —Å —Ç–æ–±–æ–π!",
                                "–î–∞–≤–∞–π –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è –∏ –æ–±—Å—É–¥–∏–º —ç—Ç–æ –ª–∏—á–Ω–æ"
                            ];
                            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                            
                            addMessage(randomResponse, true);
                            contacts[currentChat].messages.push({
                                text: randomResponse,
                                time: getCurrentTime(),
                                isReceived: true
                            });
                            saveData();
                        }, 1000 + Math.random() * 3000);
                    }
                }
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
            function addMessage(text, isReceived) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isReceived ? 'received' : 'sent'}`;
                
                messageDiv.innerHTML = `
                    <div class="message-content">
                        ${text}
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ-—Å–æ–æ–±—â–µ–Ω–∏—è
            function addVideoMessage(videoUrl, isReceived) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isReceived ? 'received' : 'sent'}`;
                
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="video-message">
                            <video controls>
                                <source src="${videoUrl}" type="video/mp4">
                            </video>
                        </div>
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
            }
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —á–∞—Ç–∞ –≤–Ω–∏–∑
            function scrollToBottom() {
                setTimeout(() => {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            function renderContacts() {
                contactsList.innerHTML = '';
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                const sortedContacts = Object.keys(contacts).sort((a, b) => {
                    const aMsgs = contacts[a].messages;
                    const bMsgs = contacts[b].messages;
                    const aLastMsgTime = aMsgs.length > 0 ? aMsgs[aMsgs.length - 1].time : '00:00';
                    const bLastMsgTime = bMsgs.length > 0 ? bMsgs[bMsgs.length - 1].time : '00:00';
                    return bLastMsgTime.localeCompare(aLastMsgTime);
                });
                
                for (const userId of sortedContacts) {
                    if (allUsers[userId]) {
                        const user = allUsers[userId];
                        const contactMsgs = contacts[userId].messages;
                        const lastMessage = contactMsgs.length > 0 
                            ? contactMsgs[contactMsgs.length - 1] 
                            : null;
                        
                        const contactElement = document.createElement('div');
                        contactElement.className = `contact-item ${currentChat === userId ? 'active' : ''}`;
                        contactElement.setAttribute('data-userid', userId);
                        contactElement.innerHTML = `
                            <img src="${user.avatar}" class="contact-avatar">
                            <div class="contact-info">
                                <div class="contact-name">${user.nickname}</div>
                                <div class="contact-last-msg">
                                    ${lastMessage 
                                        ? (lastMessage.text 
                                            ? (lastMessage.text.length > 25 
                                                ? lastMessage.text.substring(0, 25) + '...' 
                                                : lastMessage.text)
                                            : 'üìπ –í–∏–¥–µ–æ')
                                        : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}
                                </div>
                            </div>
                            ${lastMessage ? `<div class="contact-time">${lastMessage.time}</div>` : ''}
                        `;
                        contactsList.appendChild(contactElement);
                    }
                }
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–∞—Ç–∞
            function renderChat(userId) {
                chatMessages.innerHTML = '';
                
                if (contacts[userId] && contacts[userId].messages) {
                    contacts[userId].messages.forEach(msg => {
                        if (msg.text) {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `message ${msg.isReceived ? 'received' : 'sent'}`;
                            messageDiv.innerHTML = `
                                <div class="message-content">
                                    ${msg.text}
                                    <div class="message-time">${msg.time}</div>
                                </div>
                            `;
                            chatMessages.appendChild(messageDiv);
                        } else if (msg.video) {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `message ${msg.isReceived ? 'received' : 'sent'}`;
                            messageDiv.innerHTML = `
                                <div class="message-content">
                                    <div class="video-message">
                                        <video controls>
                                            <source src="${msg.video}" type="video/mp4">
                                        </video>
                                    </div>
                                    <div class="message-time">${msg.time}</div>
                                </div>
                            `;
                            chatMessages.appendChild(messageDiv);
                        }
                    });
                    
                    scrollToBottom();
                }
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            function getCurrentTime() {
                const time = new Date();
                return time.getHours() + ':' + (time.getMinutes() < 10 ? '0' : '') + time.getMinutes();
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadData();
        });
    </script>
</body>
</html>
