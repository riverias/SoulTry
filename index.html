<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SoulTry Chat</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap');
        
        :root {
            --neon-cyan: #00f0ff;
            --neon-purple: #b400ff;
            --neon-pink: #ff00e6;
            --text-glow: #e0b0ff;
            --space-dark: #0a0a1a;
            --space-light: #1e1e3a;
            --sidebar-width: 280px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }
        
        input, textarea {
            user-select: text;
            -webkit-user-select: text;
        }
        
        body {
            background: var(--space-dark);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            color: var(--text-glow);
            touch-action: pan-y;
            position: fixed;
        }
        
        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω */
        .gradient-bg {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(180, 0, 255, 0.2) 0%, transparent 25%),
                radial-gradient(circle at 70% 70%, rgba(0, 240, 255, 0.2) 0%, transparent 25%),
                radial-gradient(circle at 50% 20%, rgba(255, 0, 230, 0.15) 0%, transparent 25%);
            animation: bg-move 20s infinite alternate ease-in-out;
            z-index: -2;
        }
        
        @keyframes bg-move {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-5%, -5%); }
            50% { transform: translate(-10%, 5%); }
            75% { transform: translate(5%, 10%); }
        }
        
        /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        
        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            position: fixed;
            top: 0;
            left: calc(-1 * var(--sidebar-width));
            width: var(--sidebar-width);
            height: 100%;
            background: rgba(20, 20, 45, 0.95);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 10;
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar.active {
            transform: translateX(var(--sidebar-width));
        }
        
        /* –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .search-container {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .search-results {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .user-result {
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .user-result:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-nickname {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .user-username {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .add-contact {
            background: var(--neon-purple);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        /* –ö–æ–Ω—Ç–∞–∫—Ç—ã */
        .contacts-title {
            font-size: 1rem;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .contacts-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .contact-item {
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .contact-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .contact-item.active {
            background: rgba(180, 0, 255, 0.3);
        }
        
        /* –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        .profile {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 20px;
            position: relative;
        }
        
        .avatar-container {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            margin-bottom: 15px;
            border: 2px solid var(--neon-purple);
            box-shadow: 0 0 15px rgba(180, 0, 255, 0.5);
        }
        
        .avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        
        .profile-info {
            text-align: left;
            width: 100%;
        }
        
        .nickname {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .username {
            font-size: 0.9rem;
            opacity: 0.8;
            color: var(--neon-cyan);
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ */
        .chat-container {
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 35, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        .chat-container.sidebar-open {
            transform: translateX(var(--sidebar-width));
        }
        
        /* –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π */
        .chat-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            background: rgba(30, 30, 58, 0.7);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }
        
        .logo-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: transparent;
            border: none;
            position: absolute;
            left: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            z-index: 2;
        }
        
        .logo-btn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            border-radius: 50%;
        }
        
        .logo-btn:hover img {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 0 5px var(--neon-pink));
        }
        
        .chat-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: white;
            text-shadow: 0 0 10px var(--neon-purple);
            width: 100%;
            text-align: center;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            z-index: 1;
            padding: 0 40px;
        }
        
        /* –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º */
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-purple) transparent;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--neon-purple), var(--neon-pink));
            border-radius: 5px;
        }
        
        /* –°—Ç–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π */
        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
            animation: messageIn 0.4s ease-out forwards;
            word-break: break-word;
            opacity: 0;
            transform: translateY(10px);
            color: var(--text-glow);
        }
        
        @keyframes messageIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .received {
            background: rgba(255, 255, 255, 0.08);
            border-bottom-left-radius: 5px;
            align-self: flex-start;
            border-left: 3px solid var(--neon-cyan);
        }
        
        .sent {
            background: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%);
            color: white;
            border-bottom-right-radius: 5px;
            align-self: flex-end;
            border-right: 3px solid var(--neon-pink);
        }
        
        .message-time {
            font-size: 0.65rem;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
            font-family: 'Orbitron', sans-serif;
        }
        
        .video-message {
            max-width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .video-message video {
            width: 100%;
            border-radius: 8px;
        }
        
        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-container {
            padding: 12px 15px;
            background: rgba(20, 20, 45, 0.8);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .input-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .message-input {
            flex: 1;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 25px;
            outline: none;
            font-size: 0.95rem;
            color: var(--text-glow);
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        .message-input:focus {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 2px rgba(180, 0, 255, 0.3);
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%);
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .send-btn:active {
            transform: scale(0.95);
        }
        
        .send-icon {
            width: 22px;
            height: 22px;
            filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.7));
        }
        
        .attach-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .attach-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .video-input {
            display: none;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .modal-content {
            background: rgba(30, 30, 58, 0.95);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 30px rgba(180, 0, 255, 0.5);
            text-align: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: white;
            font-family: 'Orbitron', sans-serif;
        }
        
        .modal-input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1rem;
        }
        
        .modal-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--neon-purple);
        }
        
        .modal-btn {
            background: linear-gradient(135deg, var(--neon-purple) 0%, var(--neon-pink) 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            width: 100%;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(180, 0, 255, 0.4);
        }
        
        .username-error {
            color: #ff4d4d;
            font-size: 0.8rem;
            margin-top: -10px;
            margin-bottom: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="gradient-bg"></div>
    
    <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ -->
    <div class="overlay" id="overlay"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-title">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</div>
            <input type="text" class="modal-input" id="register-nickname" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º">
            <input type="text" class="modal-input" id="register-username" placeholder="@–≤–∞—à_—é–∑–µ—Ä–Ω–µ–π–º">
            <div class="username-error" id="username-error">–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç</div>
            <button class="modal-btn" id="register-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sidebar" id="sidebar">
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É">
            <div class="search-results" id="search-results"></div>
        </div>
        
        <div class="contacts-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        <div class="contacts-list" id="contacts-list"></div>
        
        <div class="profile">
            <div class="avatar-container">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2ZmMDBlNiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" alt="Avatar" class="avatar" id="avatar">
            </div>
            
            <div class="profile-info">
                <div class="nickname" id="nickname">SoulUser</div>
                <div class="username" id="username">@soultry</div>
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
    <div class="chat-container" id="chat-container">
        <div class="chat-header">
            <button class="logo-btn" id="menu-btn">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2ZmMDBlNiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" alt="Menu" id="menu-icon">
            </button>
            <div class="chat-title">SoulTry</div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="message received">
                <div class="message-content">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SoulTry! üåå
                    <div class="message-time">12:34</div>
                </div>
            </div>
            
            <div class="message sent">
                <div class="message-content">
                    –ù–∞–∂–º–∏ –Ω–∞ –∏–∫–æ–Ω–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤!
                    <div class="message-time">12:35</div>
                </div>
            </div>
        </div>
        
        <div class="input-container">
            <div class="input-box">
                <button class="attach-btn" id="attach-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                    </svg>
                </button>
                <input type="text" class="message-input" id="message-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button class="send-btn" id="send-btn">
                    <svg class="send-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
                <input type="file" id="video-input" class="video-input" accept="video/*">
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            const chatMessages = document.getElementById('chat-messages');
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const menuBtn = document.getElementById('menu-btn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const chatContainer = document.getElementById('chat-container');
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            const contactsList = document.getElementById('contacts-list');
            const attachBtn = document.getElementById('attach-btn');
            const videoInput = document.getElementById('video-input');
            const registerModal = document.getElementById('register-modal');
            const registerNickname = document.getElementById('register-nickname');
            const registerUsername = document.getElementById('register-username');
            const registerBtn = document.getElementById('register-btn');
            const usernameError = document.getElementById('username-error');
            const nicknameElement = document.getElementById('nickname');
            const usernameElement = document.getElementById('username');
            const avatarElement = document.getElementById('avatar');
            
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            let isMenuOpen = false;
            let currentChat = null;
            let contacts = {};
            let allUsers = {};
            let currentUser = null;
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
            function loadData() {
                const savedData = localStorage.getItem('soultryChatData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    contacts = data.contacts || {};
                    allUsers = data.allUsers || {};
                    currentChat = data.currentChat || null;
                    currentUser = data.currentUser || null;
                    
                    if (currentUser) {
                        updateProfile(currentUser);
                    }
                    
                    renderContacts();
                    if (currentChat) {
                        renderChat(currentChat);
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    if (!currentUser) {
                        registerModal.style.display = 'flex';
                    } else {
                        registerModal.style.display = 'none';
                    }
                } else {
                    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                    allUsers = {
                        'user1': {
                            id: 'user1',
                            avatar: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2I0MDBmZiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                            nickname: '–ê–ª–µ–∫—Å–µ–π',
                            username: '@alex'
                        },
                        'user2': {
                            id: 'user2',
                            avatar: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzAwZjBmZiIvPjxjaXJjbGUgY3g9IjUwIiBjeT0iMzUiIHI9IjIwIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iNTAiIGN5PSI3MCIgcj0iMjUiIGZpbGw9IiNmZmYiLz48L3N2Zz4=',
                            nickname: '–ú–∞—Ä–∏—è',
                            username: '@mary'
                        }
                    };
                    
                    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
                    contacts = {
                        'user1': {
                            messages: [
                                { text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?', time: '10:00', isReceived: true },
                                { text: '–ü—Ä–∏–≤–µ—Ç! –í—Å–µ –æ—Ç–ª–∏—á–Ω–æ!', time: '10:02', isReceived: false }
                            ]
                        }
                    };
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                    registerModal.style.display = 'flex';
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            function saveData() {
                const data = {
                    contacts,
                    allUsers,
                    currentChat,
                    currentUser
                };
                localStorage.setItem('soultryChatData', JSON.stringify(data));
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
            function updateProfile(user) {
                nicknameElement.textContent = user.nickname;
                usernameElement.textContent = user.username;
                avatarElement.src = user.avatar;
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            registerBtn.addEventListener('click', function() {
                const nickname = registerNickname.value.trim();
                let username = registerUsername.value.trim().toLowerCase();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —é–∑–µ—Ä–Ω–µ–π–º —Å @
                if (!username.startsWith('@')) {
                    username = '@' + username;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —é–∑–µ—Ä–Ω–µ–π–º–∞
                let usernameExists = false;
                for (const userId in allUsers) {
                    if (allUsers[userId].username.toLowerCase() === username.toLowerCase()) {
                        usernameExists = true;
                        break;
                    }
                }
                
                if (usernameExists) {
                    usernameError.style.display = 'block';
                    return;
                } else {
                    usernameError.style.display = 'none';
                }
                
                if (nickname && username) {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userId = 'user' + Date.now();
                    currentUser = {
                        id: userId,
                        nickname,
                        username,
                        avatar: generateRandomAvatar()
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    allUsers[userId] = {...currentUser};
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    saveData();
                    updateProfile(currentUser);
                    registerModal.style.display = 'none';
                }
            });
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
            function generateRandomAvatar() {
                const colors = ['#b400ff', '#00f0ff', '#ff00e6', '#00ff88', '#ff9900'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                return `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0i${encodeURIComponent(color)}Ii8+PGNpcmNsZSBjeD0iNTAiIGN5PSIzNSIgcj0iMjAiIGZpbGw9IiNmZmYiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjcwIiByPSIyNSIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==`;
            }
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é
            menuBtn.addEventListener('click', function() {
                isMenuOpen = !isMenuOpen;
                
                if (isMenuOpen) {
                    sidebar.classList.add('active');
                    overlay.classList.add('active');
                    chatContainer.classList.add('sidebar-open');
                } else {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    chatContainer.classList.remove('sidebar-open');
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
            overlay.addEventListener('click', function() {
                isMenuOpen = false;
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                chatContainer.classList.remove('sidebar-open');
            });
            
            // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                searchResults.innerHTML = '';
                
                if (searchTerm.length < 1) return;
                
                for (const userId in allUsers) {
                    const user = allUsers[userId];
                    if (userId === currentUser?.id) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–µ–±—è
                    if (contacts[userId]) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö
                    
                    if (user.username.toLowerCase().includes(searchTerm) || 
                        user.nickname.toLowerCase().includes(searchTerm)) {
                        
                        const userElement = document.createElement('div');
                        userElement.className = 'user-result';
                        userElement.innerHTML = `
                            <img src="${user.avatar}" class="user-avatar">
                            <div class="user-info">
                                <div class="user-nickname">${user.nickname}</div>
                                <div class="user-username">${user.username}</div>
                            </div>
                            <button class="add-contact" data-userid="${userId}">+</button>
                        `;
                        searchResults.appendChild(userElement);
                    }
                }
            });
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
            searchResults.addEventListener('click', function(e) {
                if (e.target.classList.contains('add-contact')) {
                    const userId = e.target.getAttribute('data-userid');
                    if (!contacts[userId]) {
                        contacts[userId] = { messages: [] };
                        saveData();
                        renderContacts();
                        searchInput.value = '';
                        searchResults.innerHTML = '';
                    }
                }
            });
            
            // –í—ã–±–æ—Ä —á–∞—Ç–∞
            contactsList.addEventListener('click', function(e) {
                const contactItem = e.target.closest('.contact-item');
                if (contactItem) {
                    const userId = contactItem.getAttribute('data-userid');
                    currentChat = userId;
                    saveData();
                    renderChat(userId);
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                    if (window.innerWidth < 768) {
                        isMenuOpen = false;
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                        chatContainer.classList.remove('sidebar-open');
                    }
                }
            });
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            sendBtn.addEventListener('click', function() {
                sendMessage();
            });
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ
            attachBtn.addEventListener('click', function() {
                videoInput.click();
            });
            
            videoInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && currentChat) {
                    if (file.size > 10 * 1024 * 1024) {
                        alert('–í–∏–¥–µ–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 10MB');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const videoUrl = event.target.result;
                        addVideoMessage(videoUrl, false);
                        contacts[currentChat].messages.push({
                            video: videoUrl,
                            time: getCurrentTime(),
                            isReceived: false
                        });
                        saveData();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // –§—É–Ω–∫—Ü–∏–∏
            function sendMessage() {
                const text = messageInput.value.trim();
                if (text && currentChat) {
                    addMessage(text, false);
                    contacts[currentChat].messages.push({
                        text,
                        time: getCurrentTime(),
                        isReceived: false
                    });
                    messageInput.value = '';
                    saveData();
                    
                    // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
                    setTimeout(() => {
                        const responses = [
                            "–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!",
                            "–Ø –ø–æ–ª—É—á–∏–ª —Ç–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
                            "–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!",
                            "–î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ"
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        
                        addMessage(randomResponse, true);
                        contacts[currentChat].messages.push({
                            text: randomResponse,
                            time: getCurrentTime(),
                            isReceived: true
                        });
                        saveData();
                    }, 1000 + Math.random() * 2000);
                }
            }
            
            function addMessage(text, isReceived) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isReceived ? 'received' : 'sent'}`;
                
                messageDiv.innerHTML = `
                    <div class="message-content">
                        ${text}
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            function addVideoMessage(videoUrl, isReceived) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isReceived ? 'received' : 'sent'}`;
                
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="video-message">
                            <video controls>
                                <source src="${videoUrl}" type="video/mp4">
                            </video>
                        </div>
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            function renderContacts() {
                contactsList.innerHTML = '';
                
                for (const userId in contacts) {
                    if (allUsers[userId]) {
                        const user = allUsers[userId];
                        const lastMessage = contacts[userId].messages.length > 0 
                            ? contacts[userId].messages[contacts[userId].messages.length - 1].text 
                            : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π';
                        
                        const contactElement = document.createElement('div');
                        contactElement.className = `contact-item ${currentChat === userId ? 'active' : ''}`;
                        contactElement.setAttribute('data-userid', userId);
                        contactElement.innerHTML = `
                            <img src="${user.avatar}" class="user-avatar">
                            <div class="user-info">
                                <div class="user-nickname">${user.nickname}</div>
                                <div class="user-username">${lastMessage.length > 20 ? lastMessage.substring(0, 20) + '...' : lastMessage}</div>
                            </div>
                        `;
                        contactsList.appendChild(contactElement);
                    }
                }
            }
            
            function renderChat(userId) {
                chatMessages.innerHTML = '';
                
                if (contacts[userId] && contacts[userId].messages) {
                    contacts[userId].messages.forEach(msg => {
                        if (msg.text) {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `message ${msg.isReceived ? 'received' : 'sent'}`;
                            messageDiv.innerHTML = `
                                <div class="message-content">
                                    ${msg.text}
                                    <div class="message-time">${msg.time}</div>
                                </div>
                            `;
                            chatMessages.appendChild(messageDiv);
                        } else if (msg.video) {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `message ${msg.isReceived ? 'received' : 'sent'}`;
                            messageDiv.innerHTML = `
                                <div class="message-content">
                                    <div class="video-message">
                                        <video controls>
                                            <source src="${msg.video}" type="video/mp4">
                                        </video>
                                    </div>
                                    <div class="message-time">${msg.time}</div>
                                </div>
                            `;
                            chatMessages.appendChild(messageDiv);
                        }
                    });
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }
            
            function getCurrentTime() {
                const time = new Date();
                return time.getHours() + ':' + (time.getMinutes() < 10 ? '0' : '') + time.getMinutes();
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadData();
            renderContacts();
        });
    </script>
</body>
</html>
